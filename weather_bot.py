import os, requests, json

WEBHOOK = os.getenv("WEBHOOK")
KEY     = os.getenv("WEATHER_KEY")
CITY    = os.getenv("CITY", "320506")

url = f"https://restapi.amap.com/v3/weather/weatherInfo?city={CITY}&key={KEY}&extensions=all"
r = requests.get(url, timeout=10).json()

if r.get("status") != "1":
    raise RuntimeError(r.get("info", "高德API错误"))

today = r["forecasts"][0]["casts"][0]
import random, datetime

# 随机心灵鸡汤
quotes = [
    "不管今天天气如何，记得给自己一个微笑。",
    "阳光总在风雨后，愿你也如此。",
    "每一天都是新的开始，愿你心中有光。",
    "天凉加衣，心凉加糖，愿你温暖如初。",
    "把烦恼留给昨天，把希望交给明天。",
    "愿你眼里有星辰，心中有暖阳。",
    "天气在变，心情别变，保持热爱，奔赴山海。",
    "人生不过如此,且行且珍惜。自己永远是自己的主角,不不要总在别人的
戏剧里充当配角。",
    "心里最崇拜谁,不必变成那个人,而是用那个人的精神和方法,去变成
你自己",
    "做人的精神气及气势不能输,总有一天你会东山再起。做人气势上输了,
再也不可能起来。",
     "生活不可能像你想象的那么好，但也不会像你想象的那么糟。——莫泊桑《羊脂球》[^34^]",
    "一个人可以被毁灭，但绝不能被打败。——海明威《老人与海》[^34^]",
    "不管怎么样，明天又是新的一天。——《飘》[^34^]",
    "人类的一切智慧是包含在这四个字里面的：等待和希望。——《基督山伯爵》[^34^]",
    "生活不能等待别人来安排，要自己去争取和奋斗。——路遥《平凡的世界》[^34^]",
    "当你为错过太阳而哭泣的时候，你也要再错过群星了。——泰戈尔《飞鸟集》[^34^]",
    "只有经历过地狱般的磨砺，才能练就创造天堂的力量。——泰戈尔[^34^]",
    "离你越近的地方，路途越远；最简单的音调，需要最艰苦的练习。——《泰戈尔诗选》[^35^]",
    "星星发亮，是为了让每一个人有一天都能找到属于自己的星星。——《小王子》[^35^]",
    "所有随风而逝的都属于昨天，所有历经风雨留下来的才是面向未来。——《飘》[^35^]",
    "勇敢是，当你还未开始就已知道自己会输，可你依然要去做。——《杀死一只知更鸟》[^35^]",
    "你不可能真正了解谁，除非你进入他的鞋子，陪他走上一段。——《杀死一只知更鸟》[^35^]",
    "小草也是花儿，你认识它们以后就知道了。——《小熊维尼的小屋》[^35^]",
    "你比你相信的更勇敢，比你看起来更坚强，比你以为的更聪明。——《小熊维尼的小屋》[^35^]",
    "我们的友谊比永远还要远。——《小熊维尼的小屋》[^35^]",
    "我的世界不允许你的消失，不管结局是否完美。——《未见萤火虫》[^38^]",
    "让我爱你吧，不然大熊猫开始冬眠……——语笑嫣然《瑰宝》[^38^]",
    "我相信，有些人一旦遇见，便注定要羁绊一生。——《未见萤火虫》[^38^]",
    "我爱你，并不是因为你是谁，而是因为我在你身边的时候我是谁。——《半夏锦年》[^38^]",
    "人永远都无法知道自己该要什么，因为人只能活一次。——《生命中不能承受之轻》[^35^]",
    "从现在起，我开始谨慎地选择我的生活……我要向前走。——《生命中不能承受之轻》[^35^]",
    "我本可以忍受黑暗，如果我不曾见过太阳。——艾米莉·狄金森[^35^]",
    "宽宏大量，是唯一能够照亮伟大灵魂的光芒。——雨果《巴黎圣母院》[^34^]",
    "心灵是一个特别的地方，在那里可以把天堂变地狱，把地狱变天堂。——弥尔顿《失乐园》[^34^]",
    "如果冬天来了，春天还会远吗？——雪莱[^34^]",
    "努力想得到什么东西，其实只要沉着镇静、实事求是，就可以轻易达到。——卡夫卡[^34^]",
    "每个人都会有缺陷，就像被上帝咬过的苹果。——托尔斯泰《战争与和平》[^35^]",
    "为生命画一片树叶，只要心存相信，总有奇迹发生。——欧·亨利[^35^]",
    "不要向井里吐痰，也许你还会来喝井里的水。——《静静的顿河》[^35^]",
    "人的一切痛苦，本质上都是对自己无能的愤怒。——王小波"
]

today_quote = random.choice(quotes)

text = (
    f"【机器人】苏州市吴中区今日天气\n"
    f"白天：{today['dayweather']}，{today['daytemp']}°C\n"
    f"夜间：{today['nightweather']}，{today['nighttemp']}°C\n"
    f"—— {today_quote}"
)

payload = {"msg_type": "text", "content": {"text": text}}
requests.post(WEBHOOK, json=payload)
